# Inswift Silabs Flasher GUI - 使用说明

## 详细使用步骤

### 1. 连接设备

- 使用USB线将Zigbee适配器连接到电脑
- 在Windows设备管理器中确认端口号（如COM3）

### 2. 启动程序

- 双击 `InswiftSilabsFlasher.exe`
- 程序界面将打开

### 3. 选择固件

- 点击"浏览..."按钮
- 选择 `.gbl` 格式的固件文件
- 支持的设备类型会在日志中显示

### 4. 配置设备

#### 设备端口
- **自动扫描**: 程序启动时会自动扫描可用串口并在下拉列表中显示
- **选择端口**: 从下拉列表中选择你的设备端口（如COM1, COM3）
- **刷新扫描**: 点击"刷新"按钮可以重新扫描可用串口
- **手动输入**: 如果未检测到串口，可以手动输入端口名
- **Windows查看**: 在Windows设备管理器中查看"端口(COM和LPT)"确认端口号

#### 探测方法
根据你的设备类型选择合适的探测方法：

| 探测方法 | 说明 | 默认波特率 |
|---------|------|-----------|
| ezsp | EmberZNet协议（Zigbee NCP） | 115200 |
| router | Zigbee Router | 115200 |
| bootloader | 引导模式 | 115200 |
| cpc | CPC Multi-PAN | 460800 |
| spinel | Spinel协议 | 460800 |

### 5. 开始烧录

1. 点击"开始烧录"按钮
2. 观察日志输出
3. 等待烧录完成

### 6. 烧录过程

程序会自动执行以下步骤：

```
1. 读取固件文件 ✓
2. 解析固件信息 ✓
3. 连接设备 ✓
4. 探测设备类型 ✓
5. 检查固件版本 ✓
6. 进入引导模式 ✓
7. 烧录固件... (显示进度，每1%更新)
8. 启动新固件 ✓
```

**进度显示**:
- **进度条**: 实时显示烧录进度，每1%更新一次
- **日志窗口**: 每1%显示一次详细进度信息
  - 格式: `烧录进度: X% (X.XXMB / X.XXMB)`
  - 示例: `烧录进度: 45% (1.23MB / 2.75MB)`

### 7. 写入IEEE地址（可选）

如果需要为设备设置特定的IEEE地址，可以使用写入IEEE地址功能：

#### 使用步骤
1. 确保设备运行**EmberZNet (EZSP) 固件**
   - 此功能仅支持EmberZNet设备
   - 如果设备运行其他固件类型，将无法使用此功能

2. 在"5. 写入IEEE地址"区域输入IEEE地址
   - 格式1: `00:3c:84:ff:fe:92:bb:2c`（带冒号分隔）
   - 格式2: `003c84fffe92bb2c`（无冒号，16位十六进制）
   - 两种格式都支持

3. （可选）勾选"强制写入"复选框
   - 默认不勾选：如果地址已匹配则跳过写入
   - 勾选：即使地址已匹配也强制写入

4. 点击"写入IEEE地址"按钮

5. 确认操作
   - 系统会弹出确认对话框
   - ⚠️ **警告**: 某些固件版本下，写入IEEE地址是**永久**操作，无法撤销
   - 确认后开始写入

#### 注意事项
- ⚠️ **永久操作**: 某些固件版本会将IEEE地址永久写入设备，无法更改
- ✅ **智能检测**: 如果设备当前IEEE地址已与目标地址匹配，将跳过写入
- ✅ **错误提示**: 如果设备类型不支持，会给出明确提示
- 📝 **日志记录**: 所有操作都会记录在日志窗口中

#### 适用场景
- 更换设备时需要保持相同的IEEE地址
- 修复损坏的IEEE地址
- 为设备设置特定的IEEE地址用于网络管理

## 常见问题

### Q1: 找不到设备端口

**解决方法**：
1. 程序会自动扫描串口，检查串口下拉列表是否有可用端口
2. 点击"刷新"按钮重新扫描串口
3. 打开"设备管理器"（Win+X -> 设备管理器）
4. 展开"端口(COM和LPT)"
5. 查看你的USB串口设备，记住COM号
6. 断开并重新连接设备，确认端口号变化
7. 如果自动扫描没有找到，可以手动输入端口名（如COM3）

### Q2: 设备连接失败

**可能原因**：
- 设备未正确连接
- 端口号错误
- 设备被其他程序占用
- 驱动未安装

**解决方法**：
1. 检查USB连接
2. 确认端口号正确
3. 关闭其他可能占用端口的程序
4. 重新安装USB串口驱动

### Q3: 固件验证失败

**原因**：固件文件可能损坏或不兼容

**解决方法**：
1. 重新下载固件文件
2. 确认固件适用于你的设备
3. 尝试使用"强制烧录"选项（谨慎）

### Q4: 烧录进度卡住

**解决方法**：
1. 等待一段时间（大数据传输需要时间）
2. 检查USB连接稳定性
3. 如果长时间无响应，重启程序重试

### Q5: 固件烧录成功但设备无响应

**解决方法**：
1. 重新插拔USB设备
2. 查看设备上的指示灯
3. 尝试使用其他串口工具检查设备状态

### Q6: 进度条没有显示或不动

**解决方法**：
- 正常情况：进度条会在烧录数据传输阶段开始更新
- 检查日志窗口：每1%会显示一次进度信息
- 如果长时间无更新：检查USB连接，可能需要重新连接设备

### Q7: 如何写入IEEE地址

**前提条件**：
- 设备必须运行EmberZNet (EZSP) 固件
- 其他固件类型（如CPC、Spinel等）不支持此功能

**步骤**：
1. 在"5. 写入IEEE地址"区域输入IEEE地址
2. （可选）勾选"强制写入"
3. 点击"写入IEEE地址"按钮
4. 确认操作

**常见错误**：
- "设备未运行EmberZNet固件"：设备当前固件类型不支持，需要先烧录EmberZNet固件
- "无效的IEEE地址格式"：检查地址格式，确保是8字节的十六进制数

### Q8: Router固件烧录后无法再次进入引导模式

**问题描述**：
- 设备在烧录Router固件后，再次烧录时显示"进入引导模式失败"
- 这是Router固件的一个已知问题：CLI命令方式可能不够可靠

**解决方案**：
程序已自动处理此问题：
1. **自动回退机制**：当Router类型的CLI命令（`bootloader reboot`）失败时，程序会自动尝试使用RTS/DTR硬件复位方法
2. **工作原理**：
   - 首先尝试CLI命令进入引导模式（这是最快的方法）
   - 如果CLI命令失败或超时，自动切换到RTS/DTR硬件复位
   - RTS/DTR方法通过串口的RTS和DTR信号引脚强制设备进入引导模式
3. **日志提示**：如果使用了硬件复位，日志中会显示：
   - `"Router CLI bootloader command failed. Attempting RTS/DTR hardware reset as fallback..."`
   - `"Successfully entered bootloader using RTS/DTR reset"`

**注意事项**：
- 确保USB连接稳定，硬件复位需要稳定的串口连接
- 如果两种方法都失败，请检查设备硬件或尝试重新插拔USB设备

### Q9: Multi-PAN (CPC) 固件烧录后无法再次探测或进入引导模式

**问题描述**：
- 设备在烧录Multi-PAN (CPC) 固件后，再次烧录时显示"设备探测失败"或"进入引导模式失败"
- 错误信息：`"Failed to probe running application type"` 或 `"Failed to enter bootloader"`
- 这可能是由于CPC固件通信问题或固件损坏导致的

**解决方案**：
程序已自动处理此问题：
1. **自动回退机制**：当CPC类型的协议命令失败时，程序会自动尝试使用RTS/DTR硬件复位方法
2. **工作原理**：
   - 首先尝试CPC协议命令进入引导模式（通过发送PROP_VALUE_SET和RESET命令）
   - 如果CPC协议命令失败或超时，自动切换到RTS/DTR硬件复位
   - RTS/DTR方法通过串口的RTS和DTR信号引脚强制设备进入引导模式
3. **日志提示**：如果使用了硬件复位，日志中会显示：
   - `"CPC bootloader command failed. Attempting RTS/DTR hardware reset as fallback..."`
   - `"Successfully entered bootloader using RTS/DTR reset"`

**如果探测阶段就失败了**（设备无法通信）：
1. **自动硬件复位**：程序已自动处理此情况
   - 当选择 `bootloader`、`cpc` 或 `router` 探测方法但探测失败时，程序会**自动尝试RTS/DTR硬件复位**
   - 如果硬件复位成功，程序会自动继续烧录流程
   - 这是"最后的手段"，通常可以恢复无法通信的设备

2. **手动操作步骤**：
   - **步骤1**：在GUI中选择探测方法为 `cpc`、`router` 或 `bootloader`
   - **步骤2**：点击"开始烧录"，程序会尝试探测设备
   - **步骤3**：如果探测失败，程序会自动尝试硬件复位（您会看到提示信息："正在尝试使用RTS/DTR硬件复位..."）
   - **步骤4**：等待硬件复位完成，程序会自动重新探测引导模式并继续烧录流程

3. **如果硬件复位也失败**：
   - 重新插拔USB设备（在硬件复位之后）
   - 检查USB线是否良好（尝试更换USB线）
   - 检查设备电源（某些设备需要外部供电）
   - 某些设备可能需要**按住Boot按钮并重启**才能进入引导模式
   - 检查设备驱动是否正确安装
   - 尝试使用其他串口工具（如Putty、串口助手）验证设备是否响应

**注意事项**：
- ✅ **程序会自动处理**：选择`bootloader`探测方法时，如果探测失败会自动尝试硬件复位
- 确保USB连接稳定，硬件复位需要稳定的串口连接
- 如果设备完全无法通信，可能需要检查固件是否已损坏
- 某些情况下，可能需要使用专门的硬件复位方法（如按住Boot按钮重启设备）

**重要提示**：
- ✅ **自动处理**：当CPC、Router或Bootloader探测失败时，程序会**自动尝试RTS/DTR硬件复位**
- ✅ **统一处理**：CPC、Router和Bootloader三种探测方法在失败时都会自动尝试硬件复位
- 请耐心等待硬件复位过程完成（通常需要1-2秒）
- 硬件复位后，程序会自动重新探测引导模式并继续烧录流程
- 如果硬件复位成功，日志会显示："✓ 成功！通过硬件复位进入引导模式"

## 支持的固件类型

- ✅ Zigbee NCP固件 (.gbl)
- ✅ Zigbee Router固件 (.gbl)
- ✅ OpenThread RCP固件 (.gbl)
- ✅ CPC Multi-PAN固件 (.gbl)
- ✅ EBL格式固件 (.ebl)

## 系统要求

- **操作系统**: Windows 10/11
- **Python**: 3.9+ (如果从源码运行)
- **内存**: 至少100MB可用空间
- **USB**: USB 2.0或更高

## 技术信息

- 基于: Universal Silabs Flasher
- GUI框架: Tkinter
- 打包工具: PyInstaller
- 协议: XMODEM, EZSP, CPC, Spinel

## 免责声明

使用本工具烧录固件存在风险，请确保：
1. 备份重要数据
2. 使用正确的固件文件
3. 保证电源稳定
4. 不要在烧录过程中断开USB连接

**使用本工具即表示您已理解并承担所有风险！**
